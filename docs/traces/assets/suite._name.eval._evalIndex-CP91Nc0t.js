import{c as y,r as b,j as e,B as I,a as P,R as _,u as $,g as R,L as B,S as w,b as S}from"./index-CQ4ESQH1.js";import{s as k,a as D,D as m,B as U,b as q,d as v,S as g,f as F,L as A}from"./utils-g08gnXpQ.js";/**
 * @license lucide-react v0.464.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=y("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.464.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=y("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.464.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=y("PanelLeftClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]]);function W({value:a,className:n,variant:l="ghost",size:o="icon",label:j="Copy",onCopied:t,...f}){const[c,d]=b.useState(!1);return b.useEffect(()=>{if(c){const h=setTimeout(()=>d(!1),2e3);return()=>clearTimeout(h)}},[c]),e.jsxs(I,{size:o,variant:l,className:P("text-muted-foreground hover:text-foreground",n),onClick:async()=>{try{await navigator.clipboard.writeText(a),d(!0),t?.()}catch(h){console.error("Failed to copy text:",h)}},...f,children:[c?e.jsx(H,{className:"size-4"}):e.jsx(Q,{className:"size-4"}),o!=="icon"&&(c?"Copied":j)]})}const r=({title:a,description:n,children:l,copyableText:o})=>e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("h2",{className:"font-medium text-base text-foreground",children:a}),n&&e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:n})]}),o&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(W,{value:o})})]})}),e.jsx("div",{className:"mt-1",children:l})]}),p=()=>e.jsx(g,{className:"mt-6 mb-4",orientation:"horizontal"}),C=a=>{const n=a.endPercent-a.startPercent;return e.jsxs(B,{to:"/suite/$name/eval/$evalIndex",params:{name:a.name,evalIndex:a.evalIndex},className:"px-3 py-2 hover:bg-foreground/10 transition-colors border-l-4",activeProps:{className:"border-l-4 border-primary"},activeOptions:{includeSearch:!0,exact:!0},preload:"intent",resetScroll:!1,children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between space-x-3",children:[e.jsx("span",{className:"block text-sm font-medium text-foreground",children:a.title}),e.jsx("span",{className:"text-xs text-muted-foreground",children:F(a.duration)})]}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{className:P("w-full rounded-full h-1 bg-foreground/10 transition-colors")}),e.jsx("div",{className:"absolute top-0 w-full rounded-full h-1 bg-gray-500",style:{left:`${a.startPercent}%`,width:`${n}%`}})]})]})},K=function(){const{name:n,evalIndex:l}=_.useParams(),{timestamp:o,trace:j}=_.useSearch(),[{data:{eval:t,prevEval:f,suite:c}}]=$({queries:[R({suiteName:n,evalIndex:l,suiteTimestamp:o??null})]}),d=t.traces[0]?.start_time??0,h=t.traces[t.traces.length-1]?.end_time??0,T=h-d,i=j!=null?t.traces[j]:null,u=t.traces.length>0&&t.traces.every(s=>typeof s.input_tokens=="number"&&typeof s.output_tokens=="number"&&typeof s.total_tokens=="number")?{input_tokens:k(t.traces,s=>s.input_tokens),output_tokens:k(t.traces,s=>s.output_tokens),total_tokens:k(t.traces,s=>s.total_tokens)}:void 0,N=D(t.rendered_columns),E=e.jsxs(e.Fragment,{children:[e.jsx(r,{title:"Input",description:"The input passed to the task.",copyableText:typeof t.input=="string"?t.input:void 0,children:e.jsx(m,{shouldTruncateText:!1,input:t.input})}),e.jsx(p,{}),t.expected?e.jsxs(e.Fragment,{children:[e.jsx(r,{title:"Expected",description:"A description of the expected output of the task.",copyableText:typeof t.expected=="string"?t.expected:void 0,children:e.jsx(m,{shouldTruncateText:!1,input:t.expected})}),e.jsx(p,{})]}):null,e.jsx(r,{title:"Output",description:"The output of the task.",copyableText:typeof t.output=="string"?t.output:void 0,children:e.jsx(m,{shouldTruncateText:!1,input:t.output})})]});return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-sidebar border-b border-sidebar-border shadow-sm",children:e.jsxs("div",{className:"p-2 flex items-center gap-3",children:[e.jsx(I,{size:"icon",variant:"ghost",asChild:!0,children:e.jsx(B,{to:"/suite/$name",params:{name:n},search:{timestamp:o??void 0},preload:"intent",resetScroll:!1,children:e.jsx(V,{className:"size-5 rotate-180"})})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-primary block font-semibold mb-1",children:"Trace"}),e.jsx(U,{children:e.jsxs(q,{children:[e.jsx(v,{children:e.jsx(w,{score:t.score,hasScores:t.scores.length>0,state:S({score:t.score,prevScore:f?.score,status:c.status})})}),e.jsx(g,{orientation:"vertical",className:"mx-1 h-4"}),e.jsx(v,{children:F(t.duration)}),e.jsx(g,{orientation:"vertical",className:"mx-1 h-4"}),e.jsx(v,{children:e.jsx(A,{date:c.created_at})}),u&&e.jsxs(e.Fragment,{children:[e.jsx(g,{orientation:"vertical",className:"mx-1 h-4"}),e.jsxs(v,{children:[u.total_tokens||u.input_tokens+u.output_tokens," ","Tokens"]})]})]})})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden w-full min-w-0",children:e.jsxs("div",{className:"flex flex-row min-h-full",children:[e.jsxs("div",{className:"w-44 flex flex-col gap-3 flex-shrink-0 p-2",children:[e.jsx(C,{duration:h-d,title:"Eval",startPercent:0,endPercent:100,name:n,evalIndex:l}),t.traces.map((s,x)=>{const L=s.start_time-d,O=s.end_time-d,z=L/T*100,M=O/T*100;return e.jsx(C,{duration:s.end_time-s.start_time,title:`Trace ${x+1}`,name:n,evalIndex:l,traceIndex:x,endPercent:M,startPercent:z},x)}),t.traces.length===0&&e.jsxs("span",{className:"text-xs block text-foreground/50 text-center text-balance",children:["Use ",e.jsx("code",{children:"reportTrace"})," to capture traces."]})]}),e.jsxs("div",{className:"flex-grow border-l p-4 min-w-0 w-full",children:[i==null&&e.jsxs(e.Fragment,{children:[u&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{title:"Token Usage",description:"How many tokens the entire evaluation used.",children:[e.jsxs("span",{className:"block mb-1 text-sm",children:["Input Tokens: ",u.input_tokens]}),e.jsxs("span",{className:"block",children:["Output Tokens: ",u.output_tokens]})]}),e.jsx(p,{})]}),!N&&E,N&&t.rendered_columns.map((s,x)=>e.jsxs(b.Fragment,{children:[x>0&&e.jsx(p,{}),e.jsx(r,{title:s.label,description:void 0,copyableText:typeof s.value=="string"?s.value:void 0,children:e.jsx(m,{shouldTruncateText:!1,input:s.value})})]},s.label)),t.scores.map(s=>e.jsxs(b.Fragment,{children:[e.jsx(p,{}),e.jsx(r,{title:s.name,description:s.description,children:e.jsx(w,{hasScores:t.scores.length>0,score:s.score??0,state:S({score:s.score??0,prevScore:f?.scores.find(x=>x.name===s.name)?.score,status:t.status})})},s.name),s.metadata?e.jsx("div",{className:"mt-2",children:e.jsx(m,{shouldTruncateText:!1,input:s.metadata,name:"metadata"})}):null]},s.name))]}),i&&e.jsxs(e.Fragment,{children:[typeof i.output_tokens=="number"&&typeof i.input_tokens=="number"&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{title:"Token Usage",description:"How many tokens were used by this trace.",children:[e.jsxs("span",{className:"block mb-1 text-sm",children:["Input Tokens: ",i.input_tokens]}),e.jsxs("span",{className:"block",children:["Output Tokens: ",i.output_tokens]})]}),e.jsx(p,{})]}),e.jsx(r,{title:"Input",children:e.jsx(m,{shouldTruncateText:!1,input:i.input})}),e.jsx(p,{}),e.jsx(r,{title:"Output",children:e.jsx(m,{shouldTruncateText:!1,input:i.output})})]})]})]})})]})};export{K as component};
